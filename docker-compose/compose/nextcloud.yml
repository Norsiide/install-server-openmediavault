# This file is auto-generated by openmediavault (https://www.openmediavault.org)
# WARNING: Do not edit this file, your changes will get lost.

# nextcloud
# 
#  ____   ____ __  __ 
# |  _ \ / ___|  \/  |
# | | | | |   | |\/| | This compose file was generated by DCM: https://github.com/ajnart/dcm
# | |_| | |___| |  | |
# |____/ \____|_|  |_|
#
services:

  # Nextcloud: A safe home for all your data.
  nextcloud:
    image: nextcloud:latest
    container_name: nextcloud
    restart: unless-stopped
    networks: 
      - cloud
    depends_on:
      - nextclouddb
      - redis
    ports:
      - 8081:80
    volumes:
      - /mnt/docker-compose/data/nextcloud/html:/var/www/html
      - /mnt/docker-compose/data/nextcloud/custom_apps:/var/www/html/custom_apps
      - /mnt/docker-compose/data/nextcloud/config:/var/www/html/config
      - /srv/dev-disk-by-uuid-f4a2ab85-bb2f-fa6f-be43-84102597be46/nextcloud:/var/www/html/data
      - /srv/dev-disk-by-uuid-f4a2ab85-bb2f-fa6f-be43-84102597be46/data/benjamin:/benjamin
      - /srv/dev-disk-by-uuid-f4a2ab85-bb2f-fa6f-be43-84102597be46/data/jessie:/jessie
      - /srv/dev-disk-by-uuid-f4a2ab85-bb2f-fa6f-be43-84102597be46/data/documents:/documents
      - /srv/dev-disk-by-uuid-f4a2ab85-bb2f-fa6f-be43-84102597be46/Media:/media
      - /srv/dev-disk-by-uuid-f4a2ab85-bb2f-fa6f-be43-84102597be46/Downloads:/downloads
    environment:
      - PUID=33
      - PGID=33
      - TZ=Europe/Bruxelles
      - MYSQL_DATABASE=nextcloud
      - MYSQL_USER=nextcloud
      - MYSQL_PASSWORD=xt6bBF9SHMHs1TQ6AsB*VUN95vWBAm^5zcL
      - MYSQL_HOST=nextclouddb
      - REDIS_HOST=redis

  nextclouddb:
    image: mariadb:11.8
    container_name: nextcloud-db
    restart: unless-stopped
    command: --transaction-isolation=READ-COMMITTED --binlog-format=ROW
    networks: 
      - cloud
    volumes:
      - /mnt/docker-compose/data/nextcloud/nextclouddb:/var/lib/mysql
    environment:
      - PUID=33
      - PGID=33
      - TZ=Europe/Bruxelles
      - MYSQL_RANDOM_ROOT_PASSWORD=true
      - MYSQL_PASSWORD=xt6bBF9SHMHs1TQ6AsB*VUN95vWBAm^5zcL
      - MYSQL_DATABASE=nextcloud
      - MYSQL_USER=nextcloud
      
  collabora:
    image: collabora/code
    container_name: collabora
    restart: unless-stopped
    networks: 
      - cloud
    environment:
      - PUID=33
      - PGID=33
      - TZ=Europe/Bruxelles
      - password=xt6bBF9SHMHs1TQ6AsB*VUN95vWBAm^5zcL
      - username=nextcloud
      - domain=example.com
      - extra_params=--o:ssl.enable=true
    ports:
      - 9980:9980

  redis:
    image: redis:alpine
    container_name: redis
    volumes:
      - /mnt/docker-compose/data/nextcloud/redis:/data  
    restart: unless-stopped
    networks: 
      - cloud

networks:
  cloud:
    name: cloud
    driver: bridge
